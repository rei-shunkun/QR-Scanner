<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QRコードスキャン</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }

    .qr-block {
      margin-bottom: 40px;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .qr-block label {
      display: block;
      font-size: 1rem;
      margin-bottom: 8px;
      color: #333;
    }

    .input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    input[type="text"] {
      flex: 1;
      padding: 8px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      padding: 8px 12px;
      font-size: 1rem;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
    }

    button:hover {
      background-color: #1565c0;
    }

    #qr-reader-order,
    #qr-reader-location {
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
    }

    #result {
      text-align: center;
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <!-- 注文番号 -->
  <div class="qr-block">
    <label for="order-number">注文番号:</label>
    <div class="input-group">
      <input type="text" id="order-number" />
      <button onclick="startScan('order')">QRスキャン</button>
    </div>
    <div id="qr-reader-order"></div>
  </div>

  <!-- 置場番号 -->
  <div class="qr-block">
    <label for="location-number">置場番号:</label>
    <div class="input-group">
      <input type="text" id="location-number" />
      <button onclick="startScan('location')">QRスキャン</button>
    </div>
    <div id="qr-reader-location"></div>
  </div>

  <div id="result">
    <button>照合</button>
  </div>

  <script>
    let scanners = {};

    function startScan(type) {
      const readerId = type === 'order' ? "qr-reader-order" : "qr-reader-location";
      const inputId = type === 'order' ? "order-number" : "location-number";

      if (scanners[type]) {
        scanners[type].stop().then(() => {
          document.getElementById(readerId).innerHTML = "";
          scanners[type] = null;
          startScan(type);
        });
        return;
      }

      const qrReader = new Html5Qrcode(readerId);
      scanners[type] = qrReader;

      qrReader.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: 250
        },
        (decodedText) => {
          document.getElementById(inputId).value = decodedText;
          qrReader.stop();
          scanners[type] = null;
          document.getElementById(readerId).innerHTML = "";
        },
        (errorMessage) => {
          // console.warn("読み取り失敗", errorMessage);
        }
      ).catch(err => {
        alert("カメラにアクセスできませんでした。");
        console.error(err);
      });
    }
  </script>
</body>
</html>
